ipcrm/puppet_webapp:
  PreBuild:
    - git clone https://github.com/pyenv/pyenv.git ~/.pyenv
    - export PYENV_ROOT="$HOME/.pyenv"
    - export PATH="$PYENV_ROOT/bin:$PATH"
    - eval "$(pyenv init -)"
    - pyenv install 2.7.10
    - pyenv install 3.5.0
    - pyenv local 2.7.10 3.5.0
    - pip3.5 install tox
  Build:
    - export PYENV_ROOT="$HOME/.pyenv"
    - export PATH="$PYENV_ROOT/bin:$PATH"
    - eval "$(pyenv init -)"
    - pyenv local 2.7.10 3.5.0
    - tox
    - python ./setup.py sdist
  PkgInclude:
    - 'dist/*.tar.gz'
  PostInstall:
    - sudo pip install dist/* --no-deps
  Start:
    - sudo service httpd restart
